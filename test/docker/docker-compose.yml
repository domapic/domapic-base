version: "3.5"
volumes:
  domapic_config:
  node_modules:
services:
  test:
    build:
      context: ./test
    depends_on:
      - service
    volumes:
      - type: volume
        source: domapic_config
        target: /app/config
      - type: volume
        source: node_modules
        target: /app/node_modules
      - type: bind
        source: ../../test/unit
        target: /app/test/unit
      - type: bind
        source: ../../package.json
        target: /app/package.json
      - type: bind
        source: ../${test_type}/${test_to_run}
        target: /app/test/test-to-run/specs
      - type: bind
        source: ../utils
        target: /app/test/utils
  service:
    build:
      context: ./service
    volumes:
      - type: volume
        source: domapic_config
        target: /app/config
      - type: volume
        source: node_modules
        target: /app/node_modules
      - type: bind
        source: ../../lib
        target: /app/lib
      - type: bind
        source: ../../index.js
        target: /app/index.js
      - type: bind
        source: ../services/app/${service_to_start}
        target: /app/test/services/service-to-run/lib
      - type: bind
        source: ../services/commands/${command_to_use}.sh
        target: /app/test/services/service-to-run/lib/run.sh
    env_file:
      - ../services/options/${options_to_use}.env
